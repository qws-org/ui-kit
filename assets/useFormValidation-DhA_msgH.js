import{r as d}from"./index-D4H_InIO.js";import{v as b,n as B,w as T}from"./useUiKitTheme-ke_UWyhy.js";const D={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},C={...D,customError:!0,valid:!1},$={isInvalid:!1,validationDetails:D,validationErrors:[]},U=d.createContext({}),w="__formValidationState"+Date.now();function z(t){if(t[w]){let{realtimeValidation:e,displayValidation:a,updateValidation:l,resetValidation:s,commitValidation:r}=t[w];return{realtimeValidation:e,displayValidation:a,updateValidation:l,resetValidation:s,commitValidation:r}}return _(t)}function _(t){let{isInvalid:e,validationState:a,name:l,value:s,builtinValidation:r,validate:c,validationBehavior:u="aria"}=t;a&&(e||(e=a==="invalid"));let f=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:C}:null,n=d.useMemo(()=>{if(!c||s==null)return null;let o=j(c,s);return L(o)},[c,s]);r!=null&&r.validationDetails.valid&&(r=void 0);let i=d.useContext(U),v=d.useMemo(()=>l?Array.isArray(l)?l.flatMap(o=>M(i[o])):M(i[l]):[],[i,l]),[m,A]=d.useState(i),[S,p]=d.useState(!1);i!==m&&(A(i),p(!1));let E=d.useMemo(()=>L(S?[]:v),[S,v]),x=d.useRef($),[g,y]=d.useState($),V=d.useRef($),R=()=>{if(!O)return;h(!1);let o=n||r||x.current;I(o,V.current)||(V.current=o,y(o))},[O,h]=d.useState(!1);return d.useEffect(R),{realtimeValidation:f||E||n||r||$,displayValidation:u==="native"?f||E||g:f||E||n||r||g,updateValidation(o){u==="aria"&&!I(g,o)?y(o):x.current=o},resetValidation(){let o=$;I(o,V.current)||(V.current=o,y(o)),u==="native"&&h(!1),p(!0)},commitValidation(){u==="native"&&h(!0),p(!0)}}}function M(t){return t?Array.isArray(t)?t:[t]:[]}function j(t,e){if(typeof t=="function"){let a=t(e);if(a&&typeof a!="boolean")return M(a)}return[]}function L(t){return t.length?{isInvalid:!0,validationErrors:t,validationDetails:C}:null}function I(t,e){return t===e?!0:!!t&&!!e&&t.isInvalid===e.isInvalid&&t.validationErrors.length===e.validationErrors.length&&t.validationErrors.every((a,l)=>a===e.validationErrors[l])&&Object.entries(t.validationDetails).every(([a,l])=>e.validationDetails[a]===l)}function G(t,e,a){let l=b(()=>{a&&a(e)});d.useEffect(()=>{var s;let r=t==null||(s=t.current)===null||s===void 0?void 0:s.form;return r==null||r.addEventListener("reset",l),()=>{r==null||r.removeEventListener("reset",l)}},[t,l])}function H(t,e,a){let{validationBehavior:l,focus:s}=t;B(()=>{if(l==="native"&&(a!=null&&a.current)&&!a.current.disabled){let n=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";a.current.setCustomValidity(n),a.current.hasAttribute("title")||(a.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(P(a.current))}});let r=d.useRef(!1),c=b(()=>{r.current||e.resetValidation()}),u=b(n=>{var i;e.displayValidation.isInvalid||e.commitValidation();let v=a==null||(i=a.current)===null||i===void 0?void 0:i.form;if(!n.defaultPrevented&&a&&v&&Q(v)===a.current){var m;s?s():(m=a.current)===null||m===void 0||m.focus(),T("keyboard")}n.preventDefault()}),f=b(()=>{e.commitValidation()});d.useEffect(()=>{let n=a==null?void 0:a.current;if(!n)return;let i=n.form,v=i==null?void 0:i.reset;return i&&(i.reset=()=>{r.current=!window.event||window.event.type==="message"&&window.event.target instanceof MessagePort,v==null||v.call(i),r.current=!1}),n.addEventListener("invalid",u),n.addEventListener("change",f),i==null||i.addEventListener("reset",c),()=>{n.removeEventListener("invalid",u),n.removeEventListener("change",f),i==null||i.removeEventListener("reset",c),i&&(i.reset=v)}},[a,u,f,c,l])}function F(t){let e=t.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function P(t){return{isInvalid:!t.validity.valid,validationDetails:F(t),validationErrors:t.validationMessage?[t.validationMessage]:[]}}function Q(t){for(let e=0;e<t.elements.length;e++){let a=t.elements[e];if(!a.validity.valid)return a}return null}export{z as $,G as a,H as b,w as c};

import{r as o}from"./index-D4lIrffr.js";import{k as B,l as h,m as T}from"./useFocus-DvAqnNhs.js";const D={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},C={...D,customError:!0,valid:!1},$={isInvalid:!1,validationDetails:D,validationErrors:[]},U=o.createContext({}),w="__formValidationState"+Date.now();function z(t){if(t[w]){let{realtimeValidation:e,displayValidation:a,updateValidation:n,resetValidation:u,commitValidation:d}=t[w];return{realtimeValidation:e,displayValidation:a,updateValidation:n,resetValidation:u,commitValidation:d}}return j(t)}function j(t){let{isInvalid:e,validationState:a,name:n,value:u,builtinValidation:d,validate:c,validationBehavior:v="aria"}=t;a&&(e||(e=a==="invalid"));let f=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:C}:null,r=o.useMemo(()=>{if(!c||u==null)return null;let l=k(c,u);return L(l)},[c,u]);d!=null&&d.validationDetails.valid&&(d=void 0);let i=o.useContext(U),s=o.useMemo(()=>n?Array.isArray(n)?n.flatMap(l=>M(i[l])):M(i[n]):[],[i,n]),[m,A]=o.useState(i),[S,b]=o.useState(!1);i!==m&&(A(i),b(!1));let p=o.useMemo(()=>L(S?[]:s),[S,s]),x=o.useRef($),[E,g]=o.useState($),V=o.useRef($),R=()=>{if(!O)return;y(!1);let l=r||d||x.current;I(l,V.current)||(V.current=l,g(l))},[O,y]=o.useState(!1);return o.useEffect(R),{realtimeValidation:f||p||r||d||$,displayValidation:v==="native"?f||p||E:f||p||r||d||E,updateValidation(l){v==="aria"&&!I(E,l)?g(l):x.current=l},resetValidation(){let l=$;I(l,V.current)||(V.current=l,g(l)),v==="native"&&y(!1),b(!0)},commitValidation(){v==="native"&&y(!0),b(!0)}}}function M(t){return t?Array.isArray(t)?t:[t]:[]}function k(t,e){if(typeof t=="function"){let a=t(e);if(a&&typeof a!="boolean")return M(a)}return[]}function L(t){return t.length?{isInvalid:!0,validationErrors:t,validationDetails:C}:null}function I(t,e){return t===e?!0:!!t&&!!e&&t.isInvalid===e.isInvalid&&t.validationErrors.length===e.validationErrors.length&&t.validationErrors.every((a,n)=>a===e.validationErrors[n])&&Object.entries(t.validationDetails).every(([a,n])=>e.validationDetails[a]===n)}function G(t,e,a){let{validationBehavior:n,focus:u}=t;B(()=>{if(n==="native"&&(a!=null&&a.current)&&!a.current.disabled){let r=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";a.current.setCustomValidity(r),a.current.hasAttribute("title")||(a.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(P(a.current))}});let d=o.useRef(!1),c=h(()=>{d.current||e.resetValidation()}),v=h(r=>{var i;e.displayValidation.isInvalid||e.commitValidation();let s=a==null||(i=a.current)===null||i===void 0?void 0:i.form;if(!r.defaultPrevented&&a&&s&&Q(s)===a.current){var m;u?u():(m=a.current)===null||m===void 0||m.focus(),T("keyboard")}r.preventDefault()}),f=h(()=>{e.commitValidation()});o.useEffect(()=>{let r=a==null?void 0:a.current;if(!r)return;let i=r.form,s=i==null?void 0:i.reset;return i&&(i.reset=()=>{d.current=!window.event||window.event.type==="message"&&window.event.target instanceof MessagePort,s==null||s.call(i),d.current=!1}),r.addEventListener("invalid",v),r.addEventListener("change",f),i==null||i.addEventListener("reset",c),()=>{r.removeEventListener("invalid",v),r.removeEventListener("change",f),i==null||i.removeEventListener("reset",c),i&&(i.reset=s)}},[a,v,f,c,n])}function F(t){let e=t.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function P(t){return{isInvalid:!t.validity.valid,validationDetails:F(t),validationErrors:t.validationMessage?[t.validationMessage]:[]}}function Q(t){for(let e=0;e<t.elements.length;e++){let a=t.elements[e];if(!a.validity.valid)return a}return null}export{z as $,G as a,w as b};

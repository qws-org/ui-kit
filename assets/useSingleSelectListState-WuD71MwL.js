import{a as m,b as p,c as x}from"./useSelectableItem-3hJGL3lR.js";import{r as g}from"./index-D4lIrffr.js";import{$ as M}from"./useControlledState-YrJM5BK_.js";class k{*[Symbol.iterator](){yield*this.iterable}get size(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(l){let e=this.keyMap.get(l);var t;return e&&(t=e.prevKey)!==null&&t!==void 0?t:null}getKeyAfter(l){let e=this.keyMap.get(l);var t;return e&&(t=e.nextKey)!==null&&t!==void 0?t:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(l){var e;return(e=this.keyMap.get(l))!==null&&e!==void 0?e:null}at(l){const e=[...this.getKeys()];return this.getItem(e[l])}getChildren(l){let e=this.keyMap.get(l);return(e==null?void 0:e.childNodes)||[]}constructor(l){this.keyMap=new Map,this.firstKey=null,this.lastKey=null,this.iterable=l;let e=n=>{if(this.keyMap.set(n.key,n),n.childNodes&&n.type==="section")for(let s of n.childNodes)e(s)};for(let n of l)e(n);let t=null,o=0;for(let[n,s]of this.keyMap)t?(t.nextKey=n,s.prevKey=t.key):(this.firstKey=n,s.prevKey=void 0),s.type==="item"&&(s.index=o++),t=s,t.nextKey=void 0;var d;this.lastKey=(d=t==null?void 0:t.key)!==null&&d!==void 0?d:null}}function S(i){let{filter:l,layoutDelegate:e}=i,t=m(i),o=g.useMemo(()=>i.disabledKeys?new Set(i.disabledKeys):new Set,[i.disabledKeys]),d=g.useCallback(a=>l?new k(l(a)):new k(a),[l]),n=g.useMemo(()=>({suppressTextValueWarning:i.suppressTextValueWarning}),[i.suppressTextValueWarning]),s=p(i,d,n),c=g.useMemo(()=>new x(s,t,{layoutDelegate:e}),[s,t,e]);return w(s,c),{collection:s,disabledKeys:o,selectionManager:c}}function w(i,l){const e=g.useRef(null);g.useEffect(()=>{if(l.focusedKey!=null&&!i.getItem(l.focusedKey)&&e.current){const u=e.current.getItem(l.focusedKey),v=[...e.current.getKeys()].map(K=>{const y=e.current.getItem(K);return(y==null?void 0:y.type)==="item"?y:null}).filter(K=>K!==null),r=[...i.getKeys()].map(K=>{const y=i.getItem(K);return(y==null?void 0:y.type)==="item"?y:null}).filter(K=>K!==null);var t,o;const b=((t=v==null?void 0:v.length)!==null&&t!==void 0?t:0)-((o=r==null?void 0:r.length)!==null&&o!==void 0?o:0);var d,n,s;let f=Math.min(b>1?Math.max(((d=u==null?void 0:u.index)!==null&&d!==void 0?d:0)-b+1,0):(n=u==null?void 0:u.index)!==null&&n!==void 0?n:0,((s=r==null?void 0:r.length)!==null&&s!==void 0?s:0)-1),h=null,$=!1;for(;f>=0;){if(!l.isDisabled(r[f].key)){h=r[f];break}if(f<r.length-1&&!$)f++;else{$=!0;var c,a;f>((c=u==null?void 0:u.index)!==null&&c!==void 0?c:0)&&(f=(a=u==null?void 0:u.index)!==null&&a!==void 0?a:0),f--}}l.setFocusedKey(h?h.key:null)}e.current=i},[i,l])}function F(i){var l;let[e,t]=M(i.selectedKey,(l=i.defaultSelectedKey)!==null&&l!==void 0?l:null,i.onSelectionChange),o=g.useMemo(()=>e!=null?[e]:[],[e]),{collection:d,disabledKeys:n,selectionManager:s}=S({...i,selectionMode:"single",disallowEmptySelection:!0,allowDuplicateSelectionEvents:!0,selectedKeys:o,onSelectionChange:a=>{if(a==="all")return;var u;let v=(u=a.values().next().value)!==null&&u!==void 0?u:null;v===e&&i.onSelectionChange&&i.onSelectionChange(v),t(v)}}),c=e!=null?d.getItem(e):null;return{collection:d,disabledKeys:n,selectionManager:s,selectedKey:e,setSelectedKey:t,selectedItem:c}}export{F as $};
